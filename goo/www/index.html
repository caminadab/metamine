<!DOCTYPE html>
<html>
<meta charset="utf-8">
<h2>Taal 0.1.1</h2>
<i>nu met ontkevering</i>

<p>
	Taal is de eerste <i>general purpose</i> vijfde-generatie programmeertaal.
Met een simpele syntax en een veilig typesysteem is code schrijven voor
iedereen toegankelijk geworden.
</p>
<ul>
	<li>Makkelijke en declaratieve code, zonder traditionele beslommeringen</li>
	<li>Genereer efficiënte machinecode</li>
	<li>Compileer functies naar SQL, GLSL, html+js</li>
</ul>

<i>type inference</i> en een fijne deductiemodule is dit een heerlijke taal 

	<div class="onderwerp">
		<button class="onderwerpnaam">Welkom</button>
		<div class="subonderwerp"> <button class='lesknop'>Laden...</a> </div>
	</div> 
	<div class="onderwerp">
		<button class="onderwerpnaam">Lijsten</button>
		<div class="subonderwerp"> <button class='lesknop'>Laden...</a> </div>
	</div> 
	<div class="onderwerp">
		<button class="onderwerpnaam">Ifs</button>
		<div class="subonderwerp"> <button class='lesknop'>Laden...</a> </div>
	</div> 
	<div class="onderwerp">
		<button class="onderwerpnaam">Controle</button>
		<div class="subonderwerp"> <button class='lesknop'>Laden...</a> </div>
	</div> 
	<div class="onderwerp">
		<button class="onderwerpnaam">Spellen</button>
		<div class="subonderwerp"> <button class='lesknop'>Laden...</a> </div>
	</div> 
	
	<button id="vim"><b>Vim-modus</b></button>
	<br> <!-- sorry lui -->
	<br> <!-- sorry lui -->
	
	<textarea id="broncode" name="broncode"></textarea> 
	<!--<button id="volgendeles">➟</button>-->
	<button id="tekst"><b>Tekstuitvoer</b></button>
	<button id="speel" style="color: black;"><b>▶▶▶ Afspelen ▶▶▶</b></button>
	<div id="resultaat">
	</div>
</p>

<style>

.volgendeles {
	position: absolute;
	left: -100;
	top: -100;
	font-size: 96px;
	color: darkgreen;
}

.onderwerpnaam {
  background-color: #4CAF50;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
}

/* The container <div> - needed to position the dropdown content */
.onderwerp {
  position: relative;
  display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.subonderwerp {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* Links inside the dropdown */
.subonderwerp a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

/* Change color of dropdown links on hover */
.subonderwerp a:hover {background-color: #ddd;}

/* Show the dropdown menu on hover */
.onderwerp:hover .subonderwerp {display: block;}

/* Change the background color of the dropdown button when the dropdown content is shown */
.onderwerp:hover .onderwerpnaam {background-color: #3e8e41;} 

canvas { background: #444; }
.syntaxfout { background: #800; color: #A80; }
.oplosfout { background: #049; color: #AFF; }
.typeerfout { background: #805; color: #FBF; }
.fouticoon { background: #800; color: #F88; }

.loc { cursor: pointer; text-decoration: underline; font-weight: bold; }

#speel0 {
	margin-top: 0.5cm;
	margin-bottom: 0.5cm;
	cursor: pointer;
	font-size: 48px;
	width: 100%;
	padding: 10px;
	border: 10px solid black;
	transition-property: border;
}

#speel0:hover {
	border: 10px solid white;
	animation: Knipper 0.05s linear infinite !important;
}

@keyframes Knipper {
    0%{background:yellow;color:purple;}
    100%{background:red;color:green;}
}

#speel {
	background: linear-gradient(to right, red, orange, yellow, green, cyan, blue, purple, red);
	background-size: 400% 400%;
	background-repeat: repeat;
	animation: AnimationName 20s linear infinite;
}

@keyframes AnimationName {
    100%{background-position:0% 50%}
    0%{background-position:400% 50%}
}

</style>
<link rel="stylesheet" href="lib/slang.css">
<link rel="stylesheet" href="lib/codemirror.css">

<script src="lib/codemirror.js"></script>
<script src="lib/addon/edit/matchbrackets.js"></script>
<script src="lib/addon/selection/active-line.js"></script>
<script src="lib/taal.js"></script>
<script src="lib/vim.js"></script>
<script>
	// les systeem

/*
	// code tabs
	var c1 = document.getElementById('c1');
	c1.addEventListener("click", function () {
		speelknop.style.display = 'none';
		tekstknop.style.display = 'inline';
		editor.setValue(
`a = 1 + []
uit = tekst a
`);});
	var c2 = document.getElementById('c2');
	c2.addEventListener("click", function () {
		speelknop.style.display = 'none';
		tekstknop.style.display = 'inline';
		editor.setValue(
`fib = n → (fⁿ[0,1])₀
f = [a,b] → [b,a+b]
uit = fib 30
`); }
	);
	var c3 = document.getElementById('c3');
	c3.addEventListener("click", function () {
		speelknop.style.display = 'none';
		tekstknop.style.display = 'inline';
		editor.setValue(`goed = i → ((i mod 3=0) ∧ (i mod 5=0))
s = Σ ((1 .. 1000) waarvoor goed)
uit = tekst s
; If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23.
; Find the sum of all the multiples of 3 or 5 below 1000.
		`); }
	);

	var c4 = document.getElementById('c4');
	c4.addEventListener("click", function() {
		speelknop.style.display = 'none';
		tekstknop.style.display = 'inline';
		editor.setValue(`f = [somA, i, j] → (j ≤ 4e6 ⇒ [somB, j, i + j])
j mod 2 = 0  ⇒ somB = somA + j
j mod 2 ≠ 0  ⇒ somB = somA

a = ((herhaal f) [0, 1, 1])₀
uit = tekst(a)

; Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:

; 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...

; By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.
`)});

	var cirkelcode = `; dit programma tekent door "tekening" te vullen met vormen
; qua coordinaten: linksonder is (0,0) en rechtsboven is (16/9,1)
; de code hoeft niet gesorteerd te staan
tekening = [ achtergrond, bal, groet ]

; de tekst "Hoi" aan de linkerkant
groet = schrijf(groetpos, "Hoi", wit)
	groetpos = (0, (1 + sin looptijd) / 2)


; een gele cirkel die om het centrum (0.9, 0.5) cirkelt
bal = cirkel(pos, straal, geel)
	pos = (x, y)
		x = 0.9 + 0.5 · cos(looptijd)
		y = 0.5 + 0.5 · sin(looptijd)
	straal = 0.2

interpoleer = (a,b,n) → (n·a₀+m·b₀, n·a₁+b₁·m₁, n·c₁+m·b₂)
	n + m = 1

; maak de achtergrond zwartblauw
achtergrond = rechthoek((0,0), (2,1), achtergrondkleur)
	achtergrondkleur = (0, 0, sin looptijd + 0.5)
`;
	var c5 = document.getElementById('c5');
	c5.addEventListener("click", function() {
		speelknop.style.display = 'inline';
		tekstknop.style.display = 'none';
		editor.setValue(cirkelcode);
	});
*/

	var speelknop = document.getElementById("speel");
	var tekstknop = document.getElementById("tekst");

  var editor = CodeMirror.fromTextArea(document.getElementById("broncode"), {
    lineNumbers: false,
    matchBrackets: true,
    mode: "taal",
		indentUnit: 2,
		tabSize: 2,
		indentWithTabs: true,
		theme: 'slang',
		styleActiveLine: true,
		cursorScrollMargin: 10,
		lineWrapping: true,
		height: "1200px",
		extraKeys: {
			"Shift-Enter": function(cm) { if (speelknop.style.display != 'inline') speelknop.click(); else tekstknop.click(); }
		},
  });
	editor.setValue(`; Programma's worden geschreven als lijsten van feiten.
; Elk feit is geldig zolang dat het programma draait.
; Dit programma print wat tekst en exit dan.
uit = "hallo aardkloot"`);
	if (false) editor.setValue(`; dit programma tekent door "tekening" te vullen met vormen
; qua coordinaten: linksonder is (0,0) en rechtsboven is (16/9,1)
; de code hoeft niet gesorteerd te staan
tekening = [ achtergrond, bal, groet ]

; de tekst "Hoi" aan de linkerkant
groet = schrijf(groetpos, "Hoi", wit)
	groetpos = (0, (1 + sin looptijd) / 2)


; een gele cirkel die om het centrum (0.9, 0.5) cirkelt
bal = cirkel(pos, straal, geel)
	pos = (x, y)
		x = 0.9 + 0.5 · cos(looptijd)
		y = 0.5 + 0.5 · sin(looptijd)
	straal = 0.2

; maak de achtergrond zwartblauw
achtergrond = rechthoek((0,0), (2,1), achtergrondkleur)
	achtergrondkleur = (0, 0, sin looptijd + 0.5)
`);
	// editor.setSize(null, '500px');

	// zet de codemirror selectie
	function selecteer(loc) {
		editor.setSelection(loc.anchor, loc.head);
	}

	// formatteer fout
	function formatError(error) {
		var waarom = error.waarom;
		waarom = waarom.replace('{exp}',
			`<b onclick="selecteer(` + JSON.stringify(error.isloc) + `);alert('hoi'); ">`+error.exp+`</b>`
		);

		waarom = waarom.replace('{istype}', error.istype);
		waarom = waarom.replace('{moettype}', error.moettype);
		return waarom;
	}

	// jaja!
	var oldWidgets = [];
	var oldLineWidgets = [];

	function setErrors(errors) {

		// verwijder oude
		for (var i = 0; i < oldWidgets.length; i++)
			oldWidgets[i].parentNode.removeChild(oldWidgets[i]);
		oldWidgets = [];

		for (var i = 0; i < oldLineWidgets.length; i++)
			oldLineWidgets[i].clear();
		oldLineWidgets = [];
		
		for (var i = 0; i < errors.length; i++) {
			var error = errors[i];
				var inline = document.createElement("div");
					inline.innerHTML = '<b>&nbsp;<!--⚠--></b>';
					inline.classList.add("fouticoon");
					inline.style.fontFamily = 'Verdana';
					inline.style.position = 'absolute';
					inline.style.marginRight = '0px';
					inline.style.marginTop = '-18px';
					//inline.style.zIndex	= '9';
			oldWidgets.push(inline);
			var a = editor.addWidget(error.pos, inline, {above: true});
				var message = document.createElement("div");
					message.classList.add(error.type+"fout");
					message.classList.add("fout");
					message.innerHTML = formatError(error);
			var b = editor.addLineWidget(error.pos.line, message);
			oldLineWidgets.push(b);
		}
	}

	// magische symbolen
	var magisch = {
		"*": "·",
		"@": "∘",
		"!": "¬",
	};
	var bimagisch = {
		"/0": "∅",
		"0/": "∅",
		"o/": "∅",
		"/o": "∅",
		"oo": "∞",
		"tau": "τ",
		"som": "Σ",
		"->": "→",
		"-->": "↦",
		">=": "≥",
		"<=": "≤",
		"=<": "≤",
		"=/": "≠",
		"/=": "≠",
		"=>": "⇒",
		"xx": "×",
		"^2": "²",
		"^3": "³",
		"_0": "₀",
		"_1": "₁",
		"_2": "₂",
		"^-1": "⁻¹",
		"RR": "ℝ",
		"NN": "ℕ",
		"ZZ": "ℤ",
		"BB": "𝔹",
		"QQ": "ℚ",
		"HH": "ℍ",
	};
	editor.on("beforeChange", (cm,change) => {
		if (magisch[change.text]) {
			//cm.replaceRange(magisch[change.text], change.from, change.to);
			//return true;
			change.update(change.from,change.to,magisch[change.text]);
		}
		var ch = change.from.ch;
		var line = change.from.line;

		var zin = cm.doc.getLine(line);

		var l2 = zin.substr(Math.max(ch-1, 0), 1) + change.text;
		var l3 = zin.substr(Math.max(ch-2, 0), 2) + change.text;
		var l4 = zin.substr(Math.max(ch-3, 0), 3) + change.text;
		var l5 = zin.substr(Math.max(ch-4, 0), 4) + change.text;

		var a;
		var len;
		if (bimagisch[l2]) { len = 2; a = bimagisch[l2]; }
		if (bimagisch[l3]) { len = 3; a = bimagisch[l3]; }
		if (bimagisch[l4]) { len = 4; a = bimagisch[l4]; }
		if (bimagisch[l5]) { len = 5; a = bimagisch[l5]; }
	
		if (a)
		{
			change.update({ch:ch-len+1,line:line}, {ch:change.to.ch,line:change.to.line}, a);
		}
	});

	var vim = document.getElementById("vim");
	vim.addEventListener("click", function() { editor.setOption('keyMap', 'vim'); });

	var resultaat = document.getElementById("resultaat");

	var speelknop = document.getElementById("speel");

	tekstknop.style.display = 'inline'; // jaja
	speelknop.style.display = 'none'; // jaja

	// gun de server wat rust...
	var cheatz = `
; niet gluren!
cirkel = c → (0, c₀, c₁, c₂)
rechthoek = v → (1, v₀, v₁, v₂)
schrijf = t → (2, t₀, t₁, t₂)
wit = (1,1,1)
zwart = (0,0,0)
rood = (1,0,0)
groen = (0,1,0)
blauw = (0,0,1)
oranje = (1,0.5,0)
geel = (1,1,0)
paars = (1,0,1) ; lelijk
cyaan = (0,1,1)
`;

	tekstknop.addEventListener("click", function() {
		fetch('/vt', {method: "POST", body: editor.getValue() + cheatz} )
			.then(x => x.json())
			.then(j => {
				resultaat.innerHTML = j.html || "&lt;geen uitvoer&gt;";
				setErrors(j.fouten);

				var scripts = Array.prototype.slice.call(resultaat.getElementsByTagName("script"));
				for (var i = 0; i < scripts.length; i++) {
					eval(scripts[i].innerHTML);
				}
			});
	});


	speelknop.addEventListener("click", function() {
		fetch('/vt', {method: "POST", body: editor.getValue() + cheatz} )
			.then(x => x.json())
			.then(j => {
				resultaat.innerHTML = j.html;
				setErrors(j.fouten);

				var scripts = Array.prototype.slice.call(resultaat.getElementsByTagName("script"));
				for (var i = 0; i < scripts.length; i++) {
					eval(scripts[i].innerHTML);
				}
			});
	});

		speelknop.style.display = 'none';
		tekstknop.style.display = 'inline';


var data = [
	['Intro', 'Waarde', 'Aanroepen', 'Als-Dan', 'Omschrijven', 'Omschrijflimiet'],
	['Lijst', 'waarde', 'tekst', 'als dan', 'omschrijven', 'omschrijflimiet'],
];

var kaarten = document.getElementsByClassName("onderwerp");
for (let i = 0; i < data.length; i++) {
	let kaart = kaarten[i];
	kaart.style.zIndex = '999';
	
	let link = kaart.getElementsByClassName('lesknop')[0];
	let subonderwerp = kaart.getElementsByClassName('subonderwerp')[0];
	for (let j = 0; j < data[i].length; j++) {
		let b = link.cloneNode();
		let titel = data[i][j];
		b.innerHTML = titel;
		b.style.zIndex = '999';
		b.onclick = ev => {
			fetch('/blog/taal-0.1.1/les/'+(i+1)+'.'+(j+1)+'-'+titel+'.code')
				.then(x => x.text())
				.then(t => editor.setValue(t));
		};
		subonderwerp.appendChild(b);
	}
	link.parentNode.removeChild(link);
}
	
</script>
</html>
